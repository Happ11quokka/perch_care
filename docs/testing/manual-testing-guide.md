# 수동 테스트 가이드 (小红书 피드백 9개 기능)

## 사전 준비

### 자동 테스트 먼저 실행
```bash
flutter test test/features/
```
> 53개 테스트 모두 통과 확인 후 수동 테스트 진행

### 테스트 환경 준비
- iOS 시뮬레이터 또는 실제 기기 연결
- 백엔드 서버 실행: `cd backend && docker compose up -d`
- 앱 빌드 & 실행: `flutter run`

---

## Feature 1: 체중 입력 키보드 dismiss

### 테스트 화면
홈 > 체중 기록 > 체중 추가 (+ 버튼)

### 체크리스트

| # | 테스트 항목 | 조작 방법 | 기대 결과 | Pass/Fail |
|---|-----------|----------|----------|-----------|
| 1-1 | 체중 입력 필드 키보드 표시 | 체중 입력 칸 탭 | 숫자 키보드가 올라옴 | |
| 1-2 | 외부 탭으로 키보드 dismiss | 키보드가 올라온 상태에서 입력 필드 외부 영역 탭 | 키보드가 사라짐 | |
| 1-3 | 저장 버튼 접근 가능 | 키보드 dismiss 후 | 저장 버튼이 화면에 보이고 탭 가능 | |
| 1-4 | 저장 시 키보드 자동 dismiss | 값 입력 후 저장 버튼 탭 | 키보드가 먼저 사라지고 저장 처리됨 | |
| 1-5 | 체중 기록 화면에서도 동일 | 기존 기록 편집 화면의 TextField | 외부 탭 시 키보드 dismiss | |

---

## Feature 2: 진식/수분 모달 키보드 dismiss

### 테스트 화면
홈 > 사료 기록 / 홈 > 수분 기록

### 체크리스트

| # | 테스트 항목 | 조작 방법 | 기대 결과 | Pass/Fail |
|---|-----------|----------|----------|-----------|
| 2-1 | 사료 모달 - 음식이름 필드 dismiss | 음식이름 입력 중 외부 탭 | 키보드 사라짐 | |
| 2-2 | 사료 모달 - 양(g) 필드 dismiss | 양(g) 입력 중 외부 탭 | 키보드 사라짐 | |
| 2-3 | 사료 모달 - 메모 필드 dismiss | 메모 입력 중 외부 탭 | 키보드 사라짐 | |
| 2-4 | 수분 모달 - 총 음수량 필드 dismiss | 음수량 입력 중 외부 탭 | 키보드 사라짐 | |
| 2-5 | 수분 모달 - 음수 횟수 필드 dismiss | 횟수 입력 중 외부 탭 | 키보드 사라짐 | |
| 2-6 | 필드 간 전환 시 정상 동작 | 음식이름 입력 후 양(g) 필드 탭 | 키보드 유지, 포커스만 이동 | |

---

## Feature 3: 진식 기록 수정

### 테스트 화면
홈 > 사료 기록

### 사전 조건
사료 기록이 1개 이상 있어야 함 (없으면 먼저 추가)

### 체크리스트

| # | 테스트 항목 | 조작 방법 | 기대 결과 | Pass/Fail |
|---|-----------|----------|----------|-----------|
| 3-1 | 엔트리 카드 탭 → 수정 모달 | 기존 기록 카드 탭 | 모달이 열리며 제목이 "기록 수정" (또는 해당 언어) | |
| 3-2 | 기존 값 프리필 | 모달 열림 시 | 음식이름, 양(g), 메모가 기존 값으로 채워져 있음 | |
| 3-3 | 값 수정 후 저장 | 양(g)을 다른 값으로 변경 후 저장 | 카드에 변경된 값 반영 | |
| 3-4 | 수정 후 기록 수 유지 | 수정 전후 | 기록 개수가 변하지 않음 (추가되지 않음) | |
| 3-5 | 새 기록 추가와 구분 | + 버튼 탭 | 모달 제목이 "추가 기록", 필드가 비어있음 | |
| 3-6 | 배식/취식 타입 변경 | 수정 모달에서 타입 라디오 버튼 변경 | 변경된 타입으로 저장됨 | |
| 3-7 | 시간 정보 수정 | 시간 선택 후 변경 | 변경된 시간으로 표시 | |

---

## Feature 4: 반려동물 삭제

### 테스트 화면
홈 > 프로필 > 반려동물 관리

### 사전 조건
반려동물이 2마리 이상 등록되어 있어야 함 (삭제 후 복구 불가하므로 테스트용 펫 추가 권장)

### 체크리스트

| # | 테스트 항목 | 조작 방법 | 기대 결과 | Pass/Fail |
|---|-----------|----------|----------|-----------|
| 4-1 | 삭제 버튼 표시 | 펫 프로필 화면 진입 | 펫 카드에 X(삭제) 아이콘 버튼이 보임 | |
| 4-2 | 삭제 확인 다이얼로그 | X 버튼 탭 | 경고 다이얼로그 표시: "이 반려동물을 삭제하시겠습니까? ... 영구적으로 삭제됩니다." | |
| 4-3 | 취소 시 삭제 안됨 | 다이얼로그에서 취소 탭 | 펫 목록 변화 없음 | |
| 4-4 | 확인 시 삭제 실행 | 다이얼로그에서 삭제 탭 | 해당 펫이 목록에서 사라지고 "삭제되었습니다" 스낵바 표시 | |
| 4-5 | 활성 펫 삭제 후 전환 | 현재 활성(선택된) 펫 삭제 | 남은 첫 번째 펫이 자동으로 활성화됨 | |
| 4-6 | 홈 화면 반영 | 삭제 후 홈으로 이동 | 삭제된 펫이 펫 선택기에서 사라짐 | |
| 4-7 | 서버 동기화 확인 | 삭제 후 앱 재시작 | 삭제된 펫이 여전히 안 보임 (서버에서도 삭제됨) | |

> **주의**: 삭제된 펫의 체중, 사료, 수분 기록도 함께 삭제됩니다. 중요한 데이터가 있는 펫은 테스트하지 마세요.

---

## Feature 5: BHI 디버그 print 제거

### 테스트 방법
이 기능은 자동 테스트로 충분합니다. 수동 확인이 필요하면:

| # | 테스트 항목 | 조작 방법 | 기대 결과 | Pass/Fail |
|---|-----------|----------|----------|-----------|
| 5-1 | 콘솔에 BHI DEBUG 로그 없음 | Xcode/Android Studio 콘솔을 열고 홈 화면 진입 | `[BHI DEBUG]` 로그가 출력되지 않음 | |
| 5-2 | BHI 점수 정상 표시 | 홈 화면에서 BHI 카드 확인 | BHI 점수가 정상적으로 표시됨 | |

---

## Feature 6: 중국어 시스템 로캘 자동 매칭

### 테스트 환경
기기 시스템 언어를 변경해야 합니다.

### iOS 시뮬레이터에서 언어 변경
설정 > 일반 > 언어 및 지역 > 언어 추가 > 简体中文 > 기본 언어로 설정

### 체크리스트

| # | 테스트 항목 | 조작 방법 | 기대 결과 | Pass/Fail |
|---|-----------|----------|----------|-----------|
| 6-1 | 중국어 기기 → 중국어 UI | 시스템 언어를 简体中文으로 설정 후 앱 최초 실행 | 앱이 중국어로 표시됨 (한국어 아님) | |
| 6-2 | 영어 기기 → 영어 UI | 시스템 언어를 English로 설정 후 앱 실행 | 앱이 영어로 표시됨 | |
| 6-3 | 한국어 기기 → 한국어 UI | 시스템 언어를 한국어로 설정 후 앱 실행 | 앱이 한국어로 표시됨 | |
| 6-4 | 일본어 기기 → 한국어 폴백 | 시스템 언어를 日本語로 설정 후 앱 실행 | 앱이 한국어로 표시됨 (미지원 언어 폴백) | |
| 6-5 | 사용자 수동 설정 우선 | 프로필 > 언어 설정에서 영어 선택 후 앱 재시작 | 기기 언어와 무관하게 영어로 표시 | |

> **팁**: 앱 내에서 언어를 수동으로 선택한 적이 있으면, 해당 설정이 기기 언어보다 우선합니다. 순수하게 기기 언어 매칭을 테스트하려면 앱을 삭제 후 재설치하거나, 프로필에서 언어 설정을 "자동"으로 변경하세요.

---

## Feature 7: FAQ 페이지

### 테스트 화면
홈 > 프로필 > 약관 및 정책 > 자주 묻는 질문

### 체크리스트

| # | 테스트 항목 | 조작 방법 | 기대 결과 | Pass/Fail |
|---|-----------|----------|----------|-----------|
| 7-1 | FAQ 진입 | 프로필 > "자주 묻는 질문" 탭 | FAQ 화면으로 이동, 제목 "자주 묻는 질문" 표시 | |
| 7-2 | 4개 카테고리 표시 | 스크롤하며 확인 | 일반, 기능 사용법, 계정 관리, 반려동물 관리 4개 섹션 표시 | |
| 7-3 | 질문 펼치기 | 아무 질문이나 탭 | 답변 텍스트가 펼쳐짐, 아이콘 색상 오렌지로 변경 | |
| 7-4 | 질문 접기 | 펼쳐진 질문 다시 탭 | 답변 텍스트가 접힘, 아이콘 색상 회색으로 복원 | |
| 7-5 | 여러 질문 동시 펼치기 | 2-3개 질문 연속 탭 | 여러 답변이 동시에 펼쳐짐 | |
| 7-6 | 뒤로가기 | 왼쪽 상단 뒤로가기 화살표 탭 | 이전 화면(프로필)으로 돌아감 | |
| 7-7 | 다국어 확인 | 앱 언어를 영어/중국어로 변경 후 재진입 | 해당 언어로 FAQ 내용 표시 | |

---

## Feature 8: AI 백과사전 사용량 로깅

### 테스트 화면
홈 > AI 백과사전 (카메라 배너 또는 관련 진입점)

### 사전 조건
- 백엔드 서버 실행 중
- 로그인된 상태

### 체크리스트

| # | 테스트 항목 | 조작 방법 | 기대 결과 | Pass/Fail |
|---|-----------|----------|----------|-----------|
| 8-1 | AI 질문 정상 응답 | AI 백과사전에서 질문 입력 후 전송 | AI 응답이 정상적으로 표시됨 | |
| 8-2 | 로그 DB 저장 확인 | 질문 전송 후 DB 확인 | `ai_encyclopedia_logs` 테이블에 새 로그 생성 | |
| 8-3 | 로그 필드 확인 | DB에서 로그 조회 | user_id, query_length, response_length, response_time_ms, model 값 정상 | |

### DB 확인 방법
```bash
# 백엔드 컨테이너 접속
docker compose exec db psql -U postgres -d perch_care

# 최근 로그 확인
SELECT id, user_id, query_length, response_length, response_time_ms, model, created_at
FROM ai_encyclopedia_logs
ORDER BY created_at DESC
LIMIT 5;
```

---

## Feature 9: FCM 푸시 알림

### 사전 조건
- 실제 기기 (시뮬레이터에서는 푸시 수신 불가)
- 알림 권한 허용
- 백엔드 서버 실행 중

### 체크리스트

**A. 토큰 등록**

| # | 테스트 항목 | 조작 방법 | 기대 결과 | Pass/Fail |
|---|-----------|----------|----------|-----------|
| 9-1 | 알림 권한 요청 | 앱 최초 실행 또는 로그인 | 알림 권한 다이얼로그 표시 | |
| 9-2 | 토큰 서버 등록 | 권한 허용 후 | DB `device_tokens` 테이블에 토큰 저장됨 | |
| 9-3 | 토큰 갱신 | 앱 재시작 | 토큰이 갱신되어 서버에 업데이트 | |

**B. 일일 알림 (KST 17:00)**

| # | 테스트 항목 | 조작 방법 | 기대 결과 | Pass/Fail |
|---|-----------|----------|----------|-----------|
| 9-4 | 기록 없는 날 알림 수신 | 당일 체중/사료/수분 기록 0건인 상태에서 17시 대기 | 푸시 알림 수신: "오늘 아직 기록이 없어요!" | |
| 9-5 | 기록 있는 날 알림 미수신 | 당일 기록 1건 이상 있는 상태에서 17시 대기 | 푸시 알림 수신 안됨 | |
| 9-6 | 알림 탭 → 앱 열기 | 수신된 알림 탭 | 앱이 열림 | |

**C. 수동 알림 테스트 (17시 기다리지 않고)**
```bash
# 백엔드에서 수동으로 cron job 실행
cd backend
python -m app.jobs.daily_reminder
```

### DB 확인 방법
```bash
# 디바이스 토큰 확인
SELECT user_id, platform, token, updated_at
FROM device_tokens
ORDER BY updated_at DESC
LIMIT 5;

# 알림 발송 내역 확인
SELECT user_id, title, body, created_at
FROM notifications
ORDER BY created_at DESC
LIMIT 5;
```

---

## 전체 회귀 테스트

모든 개별 기능 테스트 완료 후, 전체 플로우를 한 번 확인합니다:

| # | 테스트 항목 | 조작 방법 | 기대 결과 | Pass/Fail |
|---|-----------|----------|----------|-----------|
| R-1 | 앱 정상 실행 | `flutter run` | 스플래시 → 로그인/홈 정상 이동 | |
| R-2 | 로그인 | 이메일 또는 소셜 로그인 | 홈 화면 정상 표시 | |
| R-3 | 체중 기록 전체 플로우 | 추가 → 수정 → 확인 | 키보드 dismiss 정상, 기록 저장됨 | |
| R-4 | 사료 기록 전체 플로우 | 추가 → 수정(탭) → 삭제 | 수정 모달 정상, 기록 반영 | |
| R-5 | 수분 기록 전체 플로우 | 추가 → 확인 | 키보드 dismiss 정상, 기록 저장됨 | |
| R-6 | BHI 확인 | 홈 화면 BHI 카드 | 점수 표시, 콘솔에 디버그 로그 없음 | |
| R-7 | FAQ 확인 | 프로필 > FAQ | 4개 카테고리, 13개 Q&A 정상 | |
| R-8 | 펫 삭제 (선택사항) | 프로필 > 테스트용 펫 삭제 | 삭제 후 목록에서 사라짐 | |
| R-9 | 로그아웃 → 재로그인 | 로그아웃 후 재로그인 | 데이터 유지, 화면 정상 | |

---

## 테스트 결과 요약 템플릿

```
테스트 날짜: 2026-__-__
테스트 기기: _______________
OS 버전: _______________
앱 버전: 1.2.0+3

| Feature | 결과 | 비고 |
|---------|------|------|
| 1. 체중 키보드 dismiss | Pass / Fail | |
| 2. 진식/수분 키보드 dismiss | Pass / Fail | |
| 3. 진식 기록 수정 | Pass / Fail | |
| 4. 반려동물 삭제 | Pass / Fail | |
| 5. BHI print 제거 | Pass / Fail | |
| 6. 로캘 자동 매칭 | Pass / Fail | |
| 7. FAQ 페이지 | Pass / Fail | |
| 8. AI 로깅 | Pass / Fail | |
| 9. FCM 푸시 | Pass / Fail | |
```
